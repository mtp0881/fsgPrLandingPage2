<!DOCTYPE html>
<html>
<head>
<style>
  body { margin: 20px; background: #f0f0f0; font-family: sans-serif; }
  .container { position: relative; display: inline-block; max-width: 700px; }
  .container img { width: 100%; height: auto; display: block; }
  .pin-wrapper { position: absolute; transform: translate(-50%, -100%); cursor: move; z-index: 2; }
  .pin-wrapper:hover { z-index: 10; }
  .pin-icon { width: 20px; height: 28px; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.4)); }
  .pin-wrapper:hover .pin-icon { filter: drop-shadow(0 2px 4px rgba(220,38,38,0.6)); }
  .badge-container { position: absolute; top: 50%; transform: translateY(-50%); display: flex; align-items: center; }
  .badge-container.right { left: 100%; margin-left: 1px; }
  .badge-container.left { right: 100%; margin-right: 1px; flex-direction: row-reverse; }
  .arrow-right { width: 0; height: 0; border-right: 5px solid #059669; border-top: 4px solid transparent; border-bottom: 4px solid transparent; }
  .arrow-left { width: 0; height: 0; border-left: 5px solid #059669; border-top: 4px solid transparent; border-bottom: 4px solid transparent; }
  .badge { background: #059669; color: white; border-radius: 4px; padding: 1px 6px; font-size: 10px; font-weight: bold; white-space: nowrap; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
  .pin-wrapper:hover .badge { background: #dc2626; }
  .pin-wrapper:hover .arrow-right { border-right-color: #dc2626; }
  .pin-wrapper:hover .arrow-left { border-left-color: #dc2626; }
  .grid { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
  .grid-line-h, .grid-line-v { position: absolute; background: rgba(255,0,0,0.15); }
  .grid-line-h { width: 100%; height: 1px; }
  .grid-line-v { height: 100%; width: 1px; }
  .grid-label { position: absolute; font-size: 9px; color: red; opacity: 0.5; }
  #coords { position: fixed; top: 10px; right: 10px; background: #333; color: #0f0; 
    padding: 10px; font-family: monospace; font-size: 13px; border-radius: 8px; z-index: 100; }
  #output { position: fixed; bottom: 10px; right: 10px; background: #333; color: #fff; 
    padding: 10px; font-family: monospace; font-size: 11px; border-radius: 8px; z-index: 100; 
    max-width: 500px; white-space: pre; }
  .side-toggle { position: absolute; top: -8px; right: -8px; width: 14px; height: 14px; 
    background: #f59e0b; color: #000; border: none; border-radius: 50%; font-size: 8px; 
    cursor: pointer; display: none; line-height: 14px; text-align: center; padding: 0; }
  .pin-wrapper:hover .side-toggle { display: block; }
</style>
</head>
<body>
<h3>Map Position Debug - Drag pins to correct locations (click ⇄ on hover to toggle side)</h3>
<div id="coords">Move mouse over image</div>
<div class="container" id="mapContainer">
  <img src="/public_service/image31.png" id="mapImg"/>
  <div class="grid" id="grid"></div>
</div>
<div id="output">Pin positions will appear here</div>

<script>
const pins = [
  { id: 'hokkaido', label: '北海道', staff: 7, top: 13, left: 73, side: 'right' },
  { id: 'aomori', label: '青森', staff: 42, top: 33, left: 63, side: 'right' },
  { id: 'yamagata', label: '山形', staff: 15, top: 47, left: 59, side: 'right' },
  { id: 'kanto_area', label: '関東', staff: 91, top: 66, left: 61, side: 'right' },
  { id: 'shizuoka', label: '静岡', staff: 18, top: 72, left: 51, side: 'right' },
  { id: 'nagoya', label: '名古屋', staff: 25, top: 71, left: 44, side: 'left' },
  { id: 'osaka', label: '大阪', staff: 35, top: 74, left: 31, side: 'left' },
  { id: 'hiroshima', label: '広島', staff: 15, top: 72, left: 22, side: 'left' },
  { id: 'fukuoka', label: '福岡', staff: 20, top: 75, left: 11, side: 'left' },
];

const container = document.getElementById('mapContainer');
const grid = document.getElementById('grid');
const coordsDiv = document.getElementById('coords');
const outputDiv = document.getElementById('output');

// Create grid lines
for (let i = 10; i < 100; i += 10) {
  const h = document.createElement('div');
  h.className = 'grid-line-h';
  h.style.top = i + '%';
  grid.appendChild(h);
  const hl = document.createElement('div');
  hl.className = 'grid-label';
  hl.style.top = i + '%'; hl.style.left = '0';
  hl.textContent = i + '%';
  grid.appendChild(hl);
  
  const v = document.createElement('div');
  v.className = 'grid-line-v';
  v.style.left = i + '%';
  grid.appendChild(v);
  const vl = document.createElement('div');
  vl.className = 'grid-label';
  vl.style.left = i + '%'; vl.style.top = '0';
  vl.textContent = i + '%';
  grid.appendChild(vl);
}

function createPinEl(pin) {
  const wrapper = document.createElement('div');
  wrapper.className = 'pin-wrapper';
  wrapper.style.top = pin.top + '%';
  wrapper.style.left = pin.left + '%';

  // Pin icon SVG
  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
  svg.setAttribute('class', 'pin-icon');
  svg.setAttribute('viewBox', '0 0 24 36');
  svg.setAttribute('fill', '#ef4444');
  const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
  path.setAttribute('d', 'M12 0C5.4 0 0 5.4 0 12c0 9 12 24 12 24s12-15 12-24C24 5.4 18.6 0 12 0zm0 18c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6z');
  svg.appendChild(path);
  wrapper.appendChild(svg);

  // Badge container with arrow
  const badgeContainer = document.createElement('div');
  badgeContainer.className = 'badge-container ' + pin.side;
  
  const arrow = document.createElement('div');
  arrow.className = pin.side === 'right' ? 'arrow-right' : 'arrow-left';
  
  const badge = document.createElement('div');
  badge.className = 'badge';
  badge.textContent = pin.label + ' ' + pin.staff + '名';
  
  if (pin.side === 'right') {
    badgeContainer.appendChild(arrow);
    badgeContainer.appendChild(badge);
  } else {
    badgeContainer.appendChild(badge);
    badgeContainer.appendChild(arrow);
  }
  wrapper.appendChild(badgeContainer);

  // Side toggle button
  const toggleBtn = document.createElement('button');
  toggleBtn.className = 'side-toggle';
  toggleBtn.textContent = '⇄';
  toggleBtn.title = 'Toggle badge side';
  toggleBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    pin.side = pin.side === 'right' ? 'left' : 'right';
    wrapper.remove();
    createPinEl(pin);
    updateOutput();
  });
  wrapper.appendChild(toggleBtn);

  container.appendChild(wrapper);

  // Drag behavior
  let dragging = false;
  wrapper.addEventListener('mousedown', (e) => {
    if (e.target === toggleBtn) return;
    dragging = true; 
    e.preventDefault();
  });
  document.addEventListener('mousemove', (e) => {
    if (!dragging) return;
    const rect = container.getBoundingClientRect();
    const x = ((e.clientX - rect.left) / rect.width * 100);
    const y = ((e.clientY - rect.top) / rect.height * 100);
    wrapper.style.left = x + '%';
    wrapper.style.top = y + '%';
    pin.left = Math.round(x);
    pin.top = Math.round(y);
    updateOutput();
  });
  document.addEventListener('mouseup', () => { dragging = false; });
}

pins.forEach(pin => createPinEl(pin));

// Mouse position tracker
container.addEventListener('mousemove', (e) => {
  const rect = container.getBoundingClientRect();
  const x = ((e.clientX - rect.left) / rect.width * 100).toFixed(1);
  const y = ((e.clientY - rect.top) / rect.height * 100).toFixed(1);
  coordsDiv.textContent = `X: ${x}%  Y: ${y}%`;
});

function updateOutput() {
  outputDiv.textContent = pins.map(p => 
    `{ id: '${p.id}', top: '${p.top}%', left: '${p.left}%', side: '${p.side}' },`
  ).join('\n');
}
updateOutput();
</script>
</body>
</html>
